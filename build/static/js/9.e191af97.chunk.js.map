{"version":3,"sources":["pages/_admin/AddOffer.js"],"names":["FormItem","Form","Item","Option","Select","formStyle","css","_templateObject","tob64","file","Promise","resolve","reader","FileReader","addEventListener","e","result","readAsDataURL","AddOffer","state","zones","partners","progress","handleSubmit","preventDefault","_this","setState","props","form","validateFieldsAndScroll","err","values","date","format","image","then","JSON","stringify","Object","_ldata_my_projects_chomok_client_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","percentage","body","fetch","credentials","method","headers","Content-Type","r","status","navigate","json","rep","ok","Error","catch","console","error","getFieldDecorator","this","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","antd__WEBPACK_IMPORTED_MODULE_12__","onSubmit","className","rules","required","message","react_images_upload__WEBPACK_IMPORTED_MODULE_11___default","withIcon","singleImage","buttonText","imgExtension","maxFileSize","type","initialValue","moment","antd__WEBPACK_IMPORTED_MODULE_14__","antd__WEBPACK_IMPORTED_MODULE_13__","placeholder","antd__WEBPACK_IMPORTED_MODULE_15__","min","max","antd__WEBPACK_IMPORTED_MODULE_16__","htmlType","antd__WEBPACK_IMPORTED_MODULE_17__","_this2","res","data","map","it","key","_id","value","division","toUpperCase","name","business","React","PureComponent","ControlledAddOffer","create"],"mappings":"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","file":"static/js/9.e191af97.chunk.js","sourcesContent":["import React from 'react'\nimport moment from 'moment'\nimport PropTypes from 'prop-types'\nimport { css } from 'react-emotion'\nimport { navigate } from '@reach/router'\nimport ImageUploader from 'react-images-upload'\nimport { Form, Select, Button, Input, Icon, DatePicker } from 'antd'\n\nconst FormItem = Form.Item\nconst { Option } = Select\n\nconst formStyle = css`\n  text-align: left;\n\n  .fileContainer {\n    box-shadow: none;\n  }\n  .chooseFileButton {\n    border-radius: 3px;\n  }\n`\n\nconst tob64 = file =>\n  new Promise(resolve => {\n    const reader = new FileReader()\n    reader.addEventListener('loadend', e => {\n      resolve(reader.result)\n    })\n    reader.readAsDataURL(file)\n  })\n\nclass AddOffer extends React.PureComponent {\n  state = {\n    zones: [],\n    partners: [],\n    progress: 'plus'\n  }\n\n  handleSubmit = e => {\n    e.preventDefault()\n    this.setState({ progress: 'loading' })\n    this.props.form.validateFieldsAndScroll((err, values) => {\n      if (err) return this.setState({ progress: 'close' })\n      values.date = values.date.format('YYYYMMDD')\n      tob64(values.image[0])\n        .then(image =>\n          JSON.stringify({ ...values, percentage: +values.percentage, image })\n        )\n        .then(body =>\n          fetch('/api/offers', {\n            credentials: 'include',\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body\n          })\n        )\n        .then(r => {\n          if (r.status === 401) navigate('/login')\n          return r.json()\n        })\n        .then(rep => {\n          if (rep.ok) {\n            this.setState({ progress: 'check' })\n            navigate('/admin/offers')\n          } else throw new Error('Something wrong, again!')\n        })\n        .catch(e => {\n          this.setState({ progress: 'close' })\n          console.error(e)\n        })\n    })\n  }\n\n  render () {\n    const { getFieldDecorator } = this.props.form\n\n    return (\n      <Form onSubmit={this.handleSubmit} className={formStyle}>\n        <FormItem>\n          {getFieldDecorator('image', {\n            rules: [{ required: true, message: 'Please upload an image!' }]\n          })(\n            <ImageUploader\n              withIcon\n              singleImage\n              buttonText='Choose image'\n              imgExtension={['.jpg', '.png']}\n              maxFileSize={2098000}\n            />\n          )}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('date', {\n            rules: [\n              {\n                type: 'object',\n                required: true,\n                message: 'Please select a date!'\n              }\n            ],\n            initialValue: moment()\n          })(<DatePicker format='DD-MM-YYYY' />)}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('zoneid', {\n            rules: [{ required: true, message: 'Please select a zone!' }]\n          })(<Select placeholder='Select a zone'>{this.state.zones}</Select>)}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('partnerid', {\n            rules: [{ required: true, message: 'Please select a partner!' }]\n          })(\n            <Select placeholder='Select a partner'>\n              {this.state.partners}\n            </Select>\n          )}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('percentage', {\n            rules: [{ required: true, message: 'Please enter a percentage!' }]\n          })(\n            <Input\n              type='number'\n              min={1}\n              max={100}\n              placeholder='Enter a percentage'\n            />\n          )}\n        </FormItem>\n        <FormItem>\n          <Button\n            type={this.state.progress === 'close' ? 'danger' : 'primary'}\n            htmlType='submit'>\n            <Icon type={this.state.progress} />\n          </Button>\n        </FormItem>\n      </Form>\n    )\n  }\n\n  componentDidMount () {\n    fetch('/api/zones', { credentials: 'include' })\n      .then(r => {\n        if (r.status === 401) navigate('/login')\n        return r.json()\n      })\n      .then(res => {\n        if (!res.ok) throw new Error('Something went wrong')\n        const zones = res.data.map(it => (\n          <Option key={it._id} value={it._id}>\n            {it.division.toUpperCase()} &gt; {it.name.toUpperCase()}\n          </Option>\n        ))\n        this.setState({ zones })\n      })\n      .catch(e => console.error(e))\n    fetch('/api/users/partner', { credentials: 'include' })\n      .then(r => {\n        if (r.status === 401) navigate('/login')\n        return r.json()\n      })\n      .then(res => {\n        if (!res.ok) throw new Error('Something went wrong')\n        const partners = res.data.map(it => (\n          <Option key={it._id} value={it._id}>\n            {it.name} / {it.business.name}\n          </Option>\n        ))\n        this.setState({ partners })\n      })\n      .catch(e => console.error(e))\n  }\n\n  static propTypes = {\n    form: PropTypes.object\n  }\n}\n\nconst ControlledAddOffer = Form.create()(AddOffer)\n\nexport default ControlledAddOffer\n"],"sourceRoot":""}