{"version":3,"sources":["../node_modules/antd/es/avatar/index.js","pages/_admin/Offers.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","avatar_Avatar","_React$Component","Avatar","props","classCallCheck_default","this","_this","possibleConstructorReturn_default","__proto__","getPrototypeOf","setScale","childrenNode","avatarChildren","childrenWidth","offsetWidth","avatarWidth","react_dom","getBoundingClientRect","width","setState","scale","handleImgLoadError","onError","undefined","isImgExist","state","inherits_default","createClass_default","key","value","prevProps","prevState","children","_classNames","_classNames2","_this2","_a","prefixCls","shape","size","src","icon","className","alt","others","_state","sizeCls","classnames_default","defineProperty_default","classString","sizeStyle","height","lineHeight","fontSize","react","es_icon","type","childrenStyle","msTransform","WebkitTransform","transform","position","display","left","Math","round","sizeChildrenStyle","ref","span","style","extends_default","avatar","defaultProps","AdminOffersPage","offers","loading","listStyle","textAlign","listMapper","item","idx","react_default","a","createElement","list","Item","actions","es_button","onClick","deleteItem","_id","Meta","image","title","getItemTitle","description","getItemDesc","date","moment","isToday","isSame","text","format","Fragment","tag","color","partner","name","toUpper","zone","division","reqBy","useBy","id","fetch","method","credentials","then","res","json","_ref","ok","Error","slice","splice","catch","console","error","itemLayout","dataSource","renderItem","r","status","navigate","_ref2","data","React","PureComponent"],"mappings":"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","file":"static/js/8.fe16ccb6.chunk.js","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _defineProperty from 'babel-runtime/helpers/defineProperty';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) {\n    if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  }\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport Icon from '../icon';\nimport classNames from 'classnames';\n\nvar Avatar = function (_React$Component) {\n  _inherits(Avatar, _React$Component);\n\n  function Avatar(props) {\n    _classCallCheck(this, Avatar);\n\n    var _this = _possibleConstructorReturn(this, (Avatar.__proto__ || Object.getPrototypeOf(Avatar)).call(this, props));\n\n    _this.setScale = function () {\n      var childrenNode = _this.avatarChildren;\n\n      if (childrenNode) {\n        var childrenWidth = childrenNode.offsetWidth;\n        var avatarNode = ReactDOM.findDOMNode(_this);\n        var avatarWidth = avatarNode.getBoundingClientRect().width; // add 4px gap for each side to get better performance\n\n        if (avatarWidth - 8 < childrenWidth) {\n          _this.setState({\n            scale: (avatarWidth - 8) / childrenWidth\n          });\n        } else {\n          _this.setState({\n            scale: 1\n          });\n        }\n      }\n    };\n\n    _this.handleImgLoadError = function () {\n      var onError = _this.props.onError;\n      var errorFlag = onError ? onError() : undefined;\n\n      if (errorFlag !== false) {\n        _this.setState({\n          isImgExist: false\n        });\n      }\n    };\n\n    _this.state = {\n      scale: 1,\n      isImgExist: true\n    };\n    return _this;\n  }\n\n  _createClass(Avatar, [{\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this.setScale();\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (prevProps.children !== this.props.children || prevState.scale !== this.state.scale && this.state.scale === 1 || prevState.isImgExist !== this.state.isImgExist) {\n        this.setScale();\n      }\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _classNames,\n          _classNames2,\n          _this2 = this;\n\n      var _a = this.props,\n          prefixCls = _a.prefixCls,\n          shape = _a.shape,\n          size = _a.size,\n          src = _a.src,\n          icon = _a.icon,\n          className = _a.className,\n          alt = _a.alt,\n          others = __rest(_a, [\"prefixCls\", \"shape\", \"size\", \"src\", \"icon\", \"className\", \"alt\"]);\n\n      var _state = this.state,\n          isImgExist = _state.isImgExist,\n          scale = _state.scale;\n      var sizeCls = classNames((_classNames = {}, _defineProperty(_classNames, prefixCls + '-lg', size === 'large'), _defineProperty(_classNames, prefixCls + '-sm', size === 'small'), _classNames));\n      var classString = classNames(prefixCls, className, sizeCls, (_classNames2 = {}, _defineProperty(_classNames2, prefixCls + '-' + shape, shape), _defineProperty(_classNames2, prefixCls + '-image', src && isImgExist), _defineProperty(_classNames2, prefixCls + '-icon', icon), _classNames2));\n      var sizeStyle = typeof size === 'number' ? {\n        width: size,\n        height: size,\n        lineHeight: size + 'px',\n        fontSize: icon ? size / 2 : 18\n      } : {};\n      var children = this.props.children;\n\n      if (src && isImgExist) {\n        children = React.createElement('img', {\n          src: src,\n          onError: this.handleImgLoadError,\n          alt: alt\n        });\n      } else if (icon) {\n        children = React.createElement(Icon, {\n          type: icon\n        });\n      } else {\n        var childrenNode = this.avatarChildren;\n\n        if (childrenNode || scale !== 1) {\n          var childrenStyle = {\n            msTransform: 'scale(' + scale + ')',\n            WebkitTransform: 'scale(' + scale + ')',\n            transform: 'scale(' + scale + ')',\n            position: 'absolute',\n            display: 'inline-block',\n            left: 'calc(50% - ' + Math.round(childrenNode.offsetWidth / 2) + 'px)'\n          };\n          var sizeChildrenStyle = typeof size === 'number' ? {\n            lineHeight: size + 'px'\n          } : {};\n          children = React.createElement('span', {\n            className: prefixCls + '-string',\n            ref: function ref(span) {\n              return _this2.avatarChildren = span;\n            },\n            style: _extends({}, sizeChildrenStyle, childrenStyle)\n          }, children);\n        } else {\n          children = React.createElement('span', {\n            className: prefixCls + '-string',\n            ref: function ref(span) {\n              return _this2.avatarChildren = span;\n            }\n          }, children);\n        }\n      }\n\n      return React.createElement('span', _extends({}, others, {\n        style: _extends({}, sizeStyle, others.style),\n        className: classString\n      }), children);\n    }\n  }]);\n\n  return Avatar;\n}(React.Component);\n\nexport default Avatar;\nAvatar.defaultProps = {\n  prefixCls: 'ant-avatar',\n  shape: 'circle',\n  size: 'default'\n};","import React from 'react'\nimport moment from 'moment'\nimport { toUpper } from 'ramda'\nimport { navigate } from '@reach/router'\nimport { List, Avatar, Button, Tag } from 'antd'\n\nclass AdminOffersPage extends React.PureComponent {\n  state = {\n    offers: [],\n    loading: true\n  }\n\n  listStyle = {\n    textAlign: 'left'\n  }\n\n  render () {\n    return (\n      <List\n        loading={this.state.loading}\n        itemLayout='horizontal'\n        dataSource={this.state.offers}\n        renderItem={this.listMapper}\n      />\n    )\n  }\n\n  componentDidMount () {\n    fetch('/api/offers', { credentials: 'include' })\n      .then(r => {\n        if (r.status === 401) navigate('/login')\n        return r.json()\n      })\n      .then(({ ok, data }) => {\n        if (!ok) throw new Error('Something went wrong')\n        this.setState({ offers: data, loading: false })\n      })\n      .catch(e => {\n        console.error(e)\n      })\n  }\n\n  listMapper = (item, idx) => (\n    <List.Item\n      actions={[\n        <Button onClick={this.deleteItem(item._id, idx)} type='danger'>\n          DELETE!\n        </Button>\n      ]}\n      key={item._id}>\n      <List.Item.Meta\n        avatar={<Avatar src={item.image} size='large' shape='square' />}\n        title={this.getItemTitle(item)}\n        description={this.getItemDesc(item)}\n        style={this.listStyle}\n      />\n    </List.Item>\n  )\n\n  getItemTitle = item => {\n    const date = moment(item.date, 'YYYYMMDD')\n    const isToday = date.isSame(moment(), 'day')\n    const text = date.format('DD-MM-YYYY')\n    return (\n      <>\n        <Tag color={isToday ? 'cyan' : 'magenta'}>\n          <b>Date: </b> {isToday ? 'Today / ' : ''}\n          {text}\n        </Tag>\n        <Tag color='red'>\n          <b>Name:</b> {item.partner.name}\n        </Tag>\n        <Tag color='orange'>\n          <b>Zone:</b> {toUpper(item.zone.division + ' > ' + item.zone.name)}\n        </Tag>\n      </>\n    )\n  }\n\n  getItemDesc = item => (\n    <>\n      <Tag color='blue'>\n        <b>Request:</b> {item.reqBy.length}\n      </Tag>\n      <Tag color='green'>\n        <b>Used:</b> {item.useBy.length}\n      </Tag>\n      <Tag color='pink'>\n        <b>Unused:</b> {item.reqBy.length - item.useBy.length}\n      </Tag>\n    </>\n  )\n\n  deleteItem = (id, idx) => e => {\n    fetch('/api/offers/' + id, {\n      method: 'DELETE',\n      credentials: 'include'\n    })\n      .then(res => res.json())\n      .then(({ ok }) => {\n        if (ok) {\n          this.setState(p => {\n            const offers = p.offers.slice()\n            offers.splice(idx, 1)\n            return { offers }\n          })\n        } else {\n          throw new Error('Something went wrong')\n        }\n      })\n      .catch(e => {\n        console.error(e)\n      })\n  }\n}\n\nexport default AdminOffersPage\n"],"sourceRoot":""}