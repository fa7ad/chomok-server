{"version":3,"sources":["pages/_admin/AddOffer.js"],"names":["FormItem","Form","Item","Option","Select","formStyle","css","_templateObject","tob64","file","Promise","resolve","reader","FileReader","addEventListener","e","result","readAsDataURL","AddOffer","state","zones","partners","progress","handleSubmit","preventDefault","_this","setState","props","form","validateFieldsAndScroll","err","values","date","format","image","then","JSON","stringify","Object","_ldata_my_projects_chomok_client_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","percentage","body","fetch","credentials","method","headers","Content-Type","r","json","rep","ok","Error","navigate","catch","console","error","getFieldDecorator","this","react__WEBPACK_IMPORTED_MODULE_7___default","a","createElement","antd__WEBPACK_IMPORTED_MODULE_11__","onSubmit","className","rules","required","message","react_images_upload__WEBPACK_IMPORTED_MODULE_10___default","withIcon","singleImage","buttonText","imgExtension","maxFileSize","type","antd__WEBPACK_IMPORTED_MODULE_13__","antd__WEBPACK_IMPORTED_MODULE_12__","placeholder","antd__WEBPACK_IMPORTED_MODULE_14__","min","max","antd__WEBPACK_IMPORTED_MODULE_15__","htmlType","antd__WEBPACK_IMPORTED_MODULE_16__","_this2","status","res","data","map","it","key","_id","value","division","toUpperCase","name","business","React","PureComponent","OfferAdder","create"],"mappings":"+eAOA,IAAMA,EAAWC,IAAKC,KACdC,EAAWC,IAAXD,OAEFE,EAAYC,YAAHC,KAaTC,EAAQ,SAAAC,GAAI,OAChB,IAAIC,QAAQ,SAAAC,GACV,IAAMC,EAAS,IAAIC,WACnBD,EAAOE,iBAAiB,UAAW,SAAAC,GACjCJ,EAAQC,EAAOI,UAEjBJ,EAAOK,cAAcR,MAGnBS,6MACJC,MAAQ,CACNC,MAAO,GACPC,SAAU,GACVC,SAAU,UAGZC,aAAe,SAAAR,GACbA,EAAES,iBACFC,EAAKC,SAAS,CAAEJ,SAAU,YAC1BG,EAAKE,MAAMC,KAAKC,wBAAwB,SAACC,EAAKC,GAC5C,GAAID,EAAK,OAAOL,EAAKC,SAAS,CAAEJ,SAAU,UAC1CS,EAAOC,KAAOD,EAAOC,KAAKC,OAAO,YACjCzB,EAAMuB,EAAOG,MAAM,IAChBC,KAAK,SAAAD,GAAK,OACTE,KAAKC,UAALC,OAAAC,EAAA,EAAAD,CAAA,GAAoBP,EAApB,CAA4BS,YAAaT,EAAOS,WAAYN,aAE7DC,KAAK,SAAAM,GAAI,OACRC,MAAM,cAAe,CACnBC,YAAa,UACbC,OAAQ,OACRC,QAAS,CACPC,eAAgB,oBAElBL,WAGHN,KAAK,SAAAY,GAAC,OAAIA,EAAEC,SACZb,KAAK,SAAAc,GACJ,IAAIA,EAAIC,GAGD,MAAM,IAAIC,MAAM,2BAFrB1B,EAAKC,SAAS,CAAEJ,SAAU,UAC1B8B,YAAS,mBAGZC,MAAM,SAAAtC,GACLU,EAAKC,SAAS,CAAEJ,SAAU,UAC1BgC,QAAQC,MAAMxC,gFAKZ,IACAyC,EAAsBC,KAAK9B,MAAMC,KAAjC4B,kBAER,OACEE,EAAAC,EAAAC,cAACC,EAAA,EAAD,CAAMC,SAAUL,KAAKlC,aAAcwC,UAAW1D,GAC5CqD,EAAAC,EAAAC,cAAC5D,EAAD,KACGwD,EAAkB,QAAS,CAC1BQ,MAAO,CAAC,CAAEC,UAAU,EAAMC,QAAS,6BADpCV,CAGCE,EAAAC,EAAAC,cAACO,EAAAR,EAAD,CACES,UAAQ,EACRC,aAAW,EACXC,WAAW,eACXC,aAAc,CAAC,OAAQ,QACvBC,YAAa,WAInBd,EAAAC,EAAAC,cAAC5D,EAAD,KACGwD,EAAkB,OAAQ,CACzBQ,MAAO,CACL,CACES,KAAM,SACNR,UAAU,EACVC,QAAS,2BALdV,CAQEE,EAAAC,EAAAC,cAACc,EAAA,EAAD,CAAYzC,OAAO,iBAExByB,EAAAC,EAAAC,cAAC5D,EAAD,KACGwD,EAAkB,SAAU,CAC3BQ,MAAO,CAAC,CAAEC,UAAU,EAAMC,QAAS,2BADpCV,CAEEE,EAAAC,EAAAC,cAACe,EAAA,EAAD,CAAQC,YAAY,iBAAiBnB,KAAKtC,MAAMC,SAErDsC,EAAAC,EAAAC,cAAC5D,EAAD,KACGwD,EAAkB,YAAa,CAC9BQ,MAAO,CAAC,CAAEC,UAAU,EAAMC,QAAS,8BADpCV,CAGCE,EAAAC,EAAAC,cAACe,EAAA,EAAD,CAAQC,YAAY,oBACjBnB,KAAKtC,MAAME,YAIlBqC,EAAAC,EAAAC,cAAC5D,EAAD,KACGwD,EAAkB,aAAc,CAC/BQ,MAAO,CAAC,CAAEC,UAAU,EAAMC,QAAS,gCADpCV,CAGCE,EAAAC,EAAAC,cAACiB,EAAA,EAAD,CACEJ,KAAK,SACLK,IAAK,EACLC,IAAK,IACLH,YAAY,yBAIlBlB,EAAAC,EAAAC,cAAC5D,EAAD,KACE0D,EAAAC,EAAAC,cAACoB,EAAA,EAAD,CACEP,KAA8B,UAAxBhB,KAAKtC,MAAMG,SAAuB,SAAW,UACnD2D,SAAS,UACTvB,EAAAC,EAAAC,cAACsB,EAAA,EAAD,CAAMT,KAAMhB,KAAKtC,MAAMG,0DAOZ,IAAA6D,EAAA1B,KACnBf,MAAM,aAAc,CAAEC,YAAa,YAChCR,KAAK,SAAAY,GAEJ,OADiB,MAAbA,EAAEqC,QAAgBhC,YAAS,UACxBL,EAAEC,SAEVb,KAAK,SAAAkD,GACJ,IAAKA,EAAInC,GAAI,MAAM,IAAIC,MAAM,wBAC7B,IAAM/B,EAAQiE,EAAIC,KAAKC,IAAI,SAAAC,GAAE,OAC3B9B,EAAAC,EAAAC,cAACzD,EAAD,CAAQsF,IAAKD,EAAGE,IAAKC,MAAOH,EAAGE,KAC5BF,EAAGI,SAASC,cADf,MACoCL,EAAGM,KAAKD,iBAG9CV,EAAKzD,SAAS,CAAEN,YAEjBiC,MAAM,SAAAtC,GAAC,OAAIuC,QAAQC,MAAMxC,KAC5B2B,MAAM,qBAAsB,CAAEC,YAAa,YACxCR,KAAK,SAAAY,GAEJ,OADiB,MAAbA,EAAEqC,QAAgBhC,YAAS,UACxBL,EAAEC,SAEVb,KAAK,SAAAkD,GACJ,IAAKA,EAAInC,GAAI,MAAM,IAAIC,MAAM,wBAC7B,IAAM9B,EAAWgE,EAAIC,KAAKC,IAAI,SAAAC,GAAE,OAC9B9B,EAAAC,EAAAC,cAACzD,EAAD,CAAQsF,IAAKD,EAAGE,IAAKC,MAAOH,EAAGE,KAC5BF,EAAGM,KADN,MACeN,EAAGO,SAASD,QAG7BX,EAAKzD,SAAS,CAAEL,eAEjBgC,MAAM,SAAAtC,GAAC,OAAIuC,QAAQC,MAAMxC,YAzITiF,IAAMC,eAiJvBC,EAAajG,IAAKkG,QAALlG,CAAciB,GAElBgF","file":"static/js/12.d7353af3.chunk.js","sourcesContent":["import React from 'react'\nimport PropTypes from 'prop-types'\nimport { css } from 'react-emotion'\nimport { navigate } from '@reach/router'\nimport ImageUploader from 'react-images-upload'\nimport { Form, Select, Button, Input, Icon, DatePicker } from 'antd'\n\nconst FormItem = Form.Item\nconst { Option } = Select\n\nconst formStyle = css`\n  text-align: left;\n  .ant-row {\n    max-width: 50vw;\n  }\n  .fileContainer {\n    box-shadow: none;\n  }\n  .chooseFileButton {\n    border-radius: 3px;\n  }\n`\n\nconst tob64 = file =>\n  new Promise(resolve => {\n    const reader = new FileReader()\n    reader.addEventListener('loadend', e => {\n      resolve(reader.result)\n    })\n    reader.readAsDataURL(file)\n  })\n\nclass AddOffer extends React.PureComponent {\n  state = {\n    zones: [],\n    partners: [],\n    progress: 'plus'\n  }\n\n  handleSubmit = e => {\n    e.preventDefault()\n    this.setState({ progress: 'loading' })\n    this.props.form.validateFieldsAndScroll((err, values) => {\n      if (err) return this.setState({ progress: 'close' })\n      values.date = values.date.format('YYYYMMDD')\n      tob64(values.image[0])\n        .then(image =>\n          JSON.stringify({ ...values, percentage: +values.percentage, image })\n        )\n        .then(body =>\n          fetch('/api/offers', {\n            credentials: 'include',\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body\n          })\n        )\n        .then(r => r.json())\n        .then(rep => {\n          if (rep.ok) {\n            this.setState({ progress: 'check' })\n            navigate('/admin/offers')\n          } else throw new Error('Something wrong, again!')\n        })\n        .catch(e => {\n          this.setState({ progress: 'close' })\n          console.error(e)\n        })\n    })\n  }\n\n  render () {\n    const { getFieldDecorator } = this.props.form\n\n    return (\n      <Form onSubmit={this.handleSubmit} className={formStyle}>\n        <FormItem>\n          {getFieldDecorator('image', {\n            rules: [{ required: true, message: 'Please upload an image!' }]\n          })(\n            <ImageUploader\n              withIcon\n              singleImage\n              buttonText='Choose image'\n              imgExtension={['.jpg', '.png']}\n              maxFileSize={2098000}\n            />\n          )}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('date', {\n            rules: [\n              {\n                type: 'object',\n                required: true,\n                message: 'Please select a date!'\n              }\n            ]\n          })(<DatePicker format='DD-MM-YYYY' />)}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('zoneid', {\n            rules: [{ required: true, message: 'Please select a zone!' }]\n          })(<Select placeholder='Select a zone'>{this.state.zones}</Select>)}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('partnerid', {\n            rules: [{ required: true, message: 'Please select a partner!' }]\n          })(\n            <Select placeholder='Select a partner'>\n              {this.state.partners}\n            </Select>\n          )}\n        </FormItem>\n        <FormItem>\n          {getFieldDecorator('percentage', {\n            rules: [{ required: true, message: 'Please enter a percentage!' }]\n          })(\n            <Input\n              type='number'\n              min={1}\n              max={100}\n              placeholder='Enter a percentage'\n            />\n          )}\n        </FormItem>\n        <FormItem>\n          <Button\n            type={this.state.progress === 'close' ? 'danger' : 'primary'}\n            htmlType='submit'>\n            <Icon type={this.state.progress} />\n          </Button>\n        </FormItem>\n      </Form>\n    )\n  }\n\n  componentDidMount () {\n    fetch('/api/zones', { credentials: 'include' })\n      .then(r => {\n        if (r.status === 401) navigate('/login')\n        return r.json()\n      })\n      .then(res => {\n        if (!res.ok) throw new Error('Something went wrong')\n        const zones = res.data.map(it => (\n          <Option key={it._id} value={it._id}>\n            {it.division.toUpperCase()} &gt; {it.name.toUpperCase()}\n          </Option>\n        ))\n        this.setState({ zones })\n      })\n      .catch(e => console.error(e))\n    fetch('/api/users/partner', { credentials: 'include' })\n      .then(r => {\n        if (r.status === 401) navigate('/login')\n        return r.json()\n      })\n      .then(res => {\n        if (!res.ok) throw new Error('Something went wrong')\n        const partners = res.data.map(it => (\n          <Option key={it._id} value={it._id}>\n            {it.name} / {it.business.name}\n          </Option>\n        ))\n        this.setState({ partners })\n      })\n      .catch(e => console.error(e))\n  }\n\n  static propTypes = {\n    form: PropTypes.object\n  }\n}\n\nconst OfferAdder = Form.create()(AddOffer)\n\nexport default OfferAdder\n"],"sourceRoot":""}